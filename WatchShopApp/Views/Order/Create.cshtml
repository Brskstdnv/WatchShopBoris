@model WatchShopApp.Models.Order.OrderCreateVM

@{
    ViewData["Title"] = "Order";
}

<h1>Order Product</h1>
<hr />

<div class="row">
    <div class="col-md-6">
        <form asp-action="AddToCart" asp-controller="ShoppingCart" method="post">
            @Html.AntiForgeryToken()

            <input type="hidden" name="ProductId" value="@Model.ProductId" />
            <input type="hidden" name="Price" value="@Model.Price" />
            <input type="hidden" name="Discount" value="@Model.Discount" />
            <input type="hidden" name="Picture" value="@Model.Picture" />
            <input type="hidden" name="ProductName" value="@Model.ProductName" />

            <div class="form-group">
                <label>Product Name</label>
                <input class="form-control" value="@Model.ProductName" readonly />
            </div>

            <div class="form-group">
                <label>Image</label><br />
                <img src="@Model.Picture" alt="Product Image" width="150" />
            </div>

            <div class="form-group">
                <label>Price</label>
                <input class="form-control" value="@Model.Price" readonly />
            </div>

            <div class="form-group">
                <label>Discount (%)</label>
                <input class="form-control" value="@Model.Discount" readonly />
            </div>

            <div class="form-group">
                <label>Quantity</label>
                <input type="number" name="Quantity" id="Quantity" class="form-control"
                       value="1" min="1" max="@Model.QuantityInStock" onchange="calcSum()" />
            </div>

            <div class="form-group">
                <label>Total Price</label>
                <input type="text" name="TotalPrice" class="form-control" readonly />
            </div>

            <input type="submit" value="Add to Cart" class="btn btn-primary" />
            <a asp-action="Index" asp-controller="Product" class="btn btn-warning">Back to Products</a>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function calcSum() {
            let q = document.getElementById('Quantity').value;
            let p = document.getElementsByName('Price')[0].value;
            let d = document.getElementsByName('Discount')[0].value;
            let sum = Number(q) * (Number(p) - Number(p) * Number(d) / 100);
            document.getElementsByName('TotalPrice')[0].value = sum.toFixed(2);
        }

        // Автоматично изчисление при зареждане
        window.onload = calcSum;
    </script>

    @await Html.PartialAsync("_ValidationScriptsPartial")
}
